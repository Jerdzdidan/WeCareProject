{% extends "home/layout.html" %}
{% load crispy_forms_tags %}

{% comment %} Insert Custom Page Style Here
{% block style %}

{% endblock style %} {% endcomment %}

{% comment %} Page Body {% endcomment %}
{% block body %}

    <article class="content-section border rounded p-3 shadow-sm">
        <h1>Update Family Registration for Family #{{ family.family_no }}</h1>
        <form method="POST" action="">
          {% csrf_token %}
          <h2>Family Head Information</h2>
          <label for="head_last_name">Last Name:</label>
          <input type="text" id="head_last_name" name="head_last_name" value="{{ head.last_name }}" required>
          <br>
      
          <label for="head_first_name">First Name:</label>
          <input type="text" id="head_first_name" name="head_first_name" value="{{ head.first_name }}" required>
          <br>
      
          <label for="head_middle_name">Middle Name:</label>
          <input type="text" id="head_middle_name" name="head_middle_name" value="{{ head.middle_name }}">
          <br>
      
          <label for="head_birthdate">Birthdate:</label>
          <input type="date" id="head_birthdate" name="head_birthdate" value="{{ head.birthdate }}" required>
          <br>
      
          <label for="head_age">Age:</label>
          <input type="number" id="head_age" name="head_age" value="{{ head.age }}" required>
          <br>
      
          <label for="head_gender">Gender:</label>
          <select id="head_gender" name="head_gender" required>
            <option value="Male" {% if head.gender == "Male" %}selected{% endif %}>Male</option>
            <option value="Female" {% if head.gender == "Female" %}selected{% endif %}>Female</option>
            <option value="Other" {% if head.gender == "Other" %}selected{% endif %}>Other</option>
          </select>
          <br>
      
          <label for="head_civil_status">Civil Status:</label>
          <input type="text" id="head_civil_status" name="head_civil_status" value="{{ head.civil_status }}" required>
          <br>
      
          <label for="head_category">Category:</label>
          <select id="head_category" name="head_category">
            <option value="NA" {% if head.category == "NA" %}selected{% endif %}>N/A</option>
            <option value="Senior" {% if head.category == "Senior" %}selected{% endif %}>Senior</option>
            <option value="Children" {% if head.category == "Children" %}selected{% endif %}>Children</option>
            <option value="Solo Parent" {% if head.category == "Solo Parent" %}selected{% endif %}>Solo Parent</option>
            <option value="Pregnant" {% if head.category == "Pregnant" %}selected{% endif %}>Pregnant</option>
          </select>
          <br>
      
          <label for="head_present_address">Present Address:</label>
          <input type="text" id="head_present_address" name="head_present_address" value="{{ head.present_address }}" required>
          <br>
      
          <label for="head_contact_number">Contact Number:</label>
          <input type="text" id="head_contact_number" name="head_contact_number" value="{{ head.contact_number }}" required>
          <br>
      
          <h2>Family Members Information</h2>
          <table id="familyMembersTable" border="1">
            <thead>
              <tr>
                <th>Last Name</th>
                <th>First Name</th>
                <th>Middle Name</th>
                <th>Relationship</th>
                <th>Birthdate</th>
                <th>Age</th>
                <th>Civil Status</th>
                <th>Gender</th>
                <th>Category</th>
                <th>Present Address</th>
                <th>Contact Number</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for member in members %}
              <tr>
                <td>
                  <!-- Hidden field to keep track of the member ID -->
                  <input type="hidden" name="members[{{ forloop.counter0 }}][member_id]" value="{{ member.id }}">
                  <input type="text" name="members[{{ forloop.counter0 }}][last_name]" value="{{ member.last_name }}" required>
                </td>
                <td><input type="text" name="members[{{ forloop.counter0 }}][first_name]" value="{{ member.first_name }}" required></td>
                <td><input type="text" name="members[{{ forloop.counter0 }}][middle_name]" value="{{ member.middle_name }}"></td>
                <td><input type="text" name="members[{{ forloop.counter0 }}][relationship]" value="{{ member.relationship_to_head }}" required></td>
                <td><input type="date" name="members[{{ forloop.counter0 }}][birthdate]" value="{{ member.birthdate }}" required></td>
                <td><input type="number" name="members[{{ forloop.counter0 }}][age]" value="{{ member.age }}" required></td>
                <td><input type="text" name="members[{{ forloop.counter0 }}][civil_status]" value="{{ member.civil_status }}" required></td>
                <td>
                  <select name="members[{{ forloop.counter0 }}][gender]">
                    <option value="Male" {% if member.gender == "Male" %}selected{% endif %}>Male</option>
                    <option value="Female" {% if member.gender == "Female" %}selected{% endif %}>Female</option>
                    <option value="Other" {% if member.gender == "Other" %}selected{% endif %}>Other</option>
                  </select>
                </td>
                <td>
                  <select name="members[{{ forloop.counter0 }}][category]">
                    <option value="NA" {% if member.category == "NA" %}selected{% endif %}>N/A</option>
                    <option value="Senior" {% if member.category == "Senior" %}selected{% endif %}>Senior</option>
                    <option value="Children" {% if member.category == "Children" %}selected{% endif %}>Children</option>
                    <option value="Solo Parent" {% if member.category == "Solo Parent" %}selected{% endif %}>Solo Parent</option>
                    <option value="Pregnant" {% if member.category == "Pregnant" %}selected{% endif %}>Pregnant</option>
                  </select>
                </td>
                <td><input type="text" name="members[{{ forloop.counter0 }}][present_address]" value="{{ member.present_address }}" required></td>
                <td><input type="text" name="members[{{ forloop.counter0 }}][contact_number]" value="{{ member.contact_number }}" required></td>
                <td><button type="button" onclick="deleteFamilyMemberRow(this)">Delete</button></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button type="button" onclick="addFamilyMemberRow()">Add Family Member</button>
          <br><br>
          <input type="submit" value="Update">
        </form>
    </article>

{% endblock %}


{% comment %} Insert Custom Page Script Here {% endcomment %}
{% block script %}
<script>
    function addFamilyMemberRow() {
      const tbody = document.getElementById('familyMembersTable').getElementsByTagName('tbody')[0];
      const rowCount = tbody.rows.length;
      const row = tbody.insertRow(rowCount);
      
      row.innerHTML = `
        <td>
          <input type="hidden" name="members[${rowCount}][member_id]" value="">
          <input type="text" name="members[${rowCount}][last_name]" required>
        </td>
        <td><input type="text" name="members[${rowCount}][first_name]" required></td>
        <td><input type="text" name="members[${rowCount}][middle_name]"></td>
        <td><input type="text" name="members[${rowCount}][relationship]" required></td>
        <td><input type="date" name="members[${rowCount}][birthdate]" required></td>
        <td><input type="number" name="members[${rowCount}][age]" required></td>
        <td><input type="text" name="members[${rowCount}][civil_status]" required></td>
        <td>
          <select name="members[${rowCount}][gender]">
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </td>
        <td>
          <select name="members[${rowCount}][category]">
            <option value="NA">N/A</option>
            <option value="Senior">Senior</option>
            <option value="Children">Children</option>
            <option value="Solo Parent">Solo Parent</option>
            <option value="Pregnant">Pregnant</option>
          </select>
        </td>
        <td><input type="text" name="members[${rowCount}][present_address]" required></td>
        <td><input type="text" name="members[${rowCount}][contact_number]" required></td>
        <td><button type="button" onclick="deleteFamilyMemberRow(this)">Delete</button></td>
      `;
    }

    function deleteFamilyMemberRow(btn) {
      const row = btn.parentNode.parentNode;
      row.parentNode.removeChild(row);
    }
</script>
{% endblock script %} 